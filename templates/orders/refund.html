{% extends 'base.html' %}
{% load static %}
{% block title %}
Sociala/Refund
{% endblock title %}

{% block body %}
        
    <div style='margin-top: 70px' class="container theme-dark-bg">
        
        <div class="middle-sidebar-bottom">
            <div class="middle-sidebar-left">
                <div class="middle-wrap">
                    <div class="card w-100 border-0 bg-white shadow-xs p-0 mb-4">
                        <div class="card-body p-4 w-100 bg-current border-0 d-flex rounded-3">
                            <a href="{% url 'order-detail' order.order_number %}" class="d-inline-block mt-2"><i class="ti-arrow-left font-sm text-white"></i></a>
                            <h4 class="font-xs text-white fw-600 ms-4 mb-0 mt-2">Refund</h4>
                        </div>
                        <div class="card-body p-lg-5 p-4 w-100 border-0 mb-0">
                            <form method="POST" id='orderForm'>
                                {% csrf_token %}
                                <h5 class='text-center'>Are you sure you want to Refund this order?</h5><br>
                                <p>Order Number: <span class='text-warning mr-2' id="orderId">{{order.order_number}}</span> <i id="copyBtn" class="ti-clipboard">Copy</i></p>
                                <div class="form-group">
                                    <div id="validationMessage" style="color: red; display: none;">Order Number does not match.</div>
                                    {{form}}
                                </div>
                                <a href="{% url 'order-detail' order.order_number %}" class="btn btn-secondary">Cancel</a>
                                <button type="submit" class="btn btn-primary">Request</button>
                            </form>
                        </div>
                    </div>
                    <!-- <div class="card w-100 border-0 p-2"></div> -->
                </div>
            </div>
                
        </div>            
    </div>


    {% block script %}
        <script>
            const copyBtn = document.getElementById('copyBtn');
            const orderId = document.getElementById('orderId').innerText;


            // Copy order ID to clipboard
            copyBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(orderId).then(() => {

            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
            });
            
            document.getElementById('orderForm').addEventListener('submit', function(event) {
                event.preventDefault(); 
            
                const enteredOrderID = document.getElementById('id_order_number').value;
                const actualOrderID = '{{ order.order_number }}'; 
            
                if (enteredOrderID !== actualOrderID) {
                    document.getElementById('validationMessage').style.display = 'block';

                } else {
                    document.getElementById('validationMessage').style.display = 'none';
                    this.submit();
                }
            });
            
        </script>
    {% endblock script %}

{% endblock %}